# ğŸ”§ é«˜çº§è®¾ç½®ä¿å­˜åŠŸèƒ½ä¿®å¤è¯´æ˜

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆåœ¨é«˜çº§è®¾ç½®ä¸­è‡ªå®šä¹‰æç¤ºè¯åï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®æ— æ³•æˆåŠŸä¿å­˜è®¾ç½®ã€‚

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡ä»£ç æ£€æŸ¥å‘ç°ï¼Œ`save_settings` æ–¹æ³•åªä¿å­˜äº†ï¼š
- APIæœåŠ¡å•†é…ç½®
- æ¨¡å‹é€‰æ‹©

ä½†**æ²¡æœ‰ä¿å­˜**é«˜çº§è®¾ç½®ä¸­çš„ï¼š
- ç›®æ ‡è¯­è¨€ (`target_lang_var`)
- ç¿»è¯‘é£æ ¼ (`style_var`)
- è‡ªå®šä¹‰æç¤ºè¯ (`prompt_text`)

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ‰©å±•é…ç½®ç®¡ç†å™¨

åœ¨ `config.py` ä¸­æ·»åŠ äº†é«˜çº§è®¾ç½®æ”¯æŒï¼š

```python
def update_advanced_settings(self, advanced_settings: Dict[str, Any]):
    """æ›´æ–°é«˜çº§è®¾ç½®"""
    if "advanced_settings" not in self.config:
        self.config["advanced_settings"] = {}
    self.config["advanced_settings"].update(advanced_settings)
    self.save_config()

def get_advanced_settings(self) -> Dict[str, Any]:
    """è·å–é«˜çº§è®¾ç½®"""
    return self.config.get("advanced_settings", {})

def get_target_language(self) -> str:
    """è·å–ç›®æ ‡è¯­è¨€"""
    return self.get_advanced_settings().get("target_language", "ä¸­æ–‡")

def get_translation_style(self) -> str:
    """è·å–ç¿»è¯‘é£æ ¼"""
    return self.get_advanced_settings().get("translation_style", "è‡ªç„¶")

def get_custom_prompt(self) -> str:
    """è·å–è‡ªå®šä¹‰æç¤ºè¯"""
    # è¿”å›ä¿å­˜çš„è‡ªå®šä¹‰æç¤ºè¯æˆ–é»˜è®¤æç¤ºè¯
```

### 2. ä¿®å¤ä¿å­˜é€»è¾‘

åœ¨ `comic_full_translator.py` çš„ `save_settings` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
# ä¿å­˜é«˜çº§è®¾ç½®
advanced_settings = {}

# ä¿å­˜ç›®æ ‡è¯­è¨€
if hasattr(self, 'target_lang_var'):
    advanced_settings["target_language"] = self.target_lang_var.get()

# ä¿å­˜ç¿»è¯‘é£æ ¼
if hasattr(self, 'style_var'):
    advanced_settings["translation_style"] = self.style_var.get()

# ä¿å­˜è‡ªå®šä¹‰æç¤ºè¯
if hasattr(self, 'prompt_text'):
    custom_prompt = self.prompt_text.get(1.0, tk.END).strip()
    advanced_settings["custom_prompt"] = custom_prompt

# æ›´æ–°é«˜çº§è®¾ç½®åˆ°é…ç½®
if advanced_settings:
    config_manager.update_advanced_settings(advanced_settings)
```

### 3. ä¿®å¤åŠ è½½é€»è¾‘

ä¿®æ”¹è®¾ç½®çª—å£åˆå§‹åŒ–ï¼Œä»é…ç½®æ–‡ä»¶åŠ è½½å·²ä¿å­˜çš„è®¾ç½®ï¼š

```python
# ç›®æ ‡è¯­è¨€ - ä»é…ç½®åŠ è½½
self.target_lang_var = tk.StringVar(value=config_manager.get_target_language())

# ç¿»è¯‘é£æ ¼ - ä»é…ç½®åŠ è½½
self.style_var = tk.StringVar(value=config_manager.get_translation_style())

# è‡ªå®šä¹‰æç¤ºè¯ - ä»é…ç½®åŠ è½½
saved_prompt = config_manager.get_custom_prompt()
self.prompt_text.insert(1.0, saved_prompt)
```

### 4. åº”ç”¨ä¿å­˜çš„è®¾ç½®

ä¿®æ”¹ç¿»è¯‘åŠŸèƒ½ï¼Œä½¿ç”¨ä¿å­˜çš„é«˜çº§è®¾ç½®ï¼š

```python
# è·å–é«˜çº§è®¾ç½®
target_language = config_manager.get_target_language()
translation_style = config_manager.get_translation_style()
custom_prompt = config_manager.get_custom_prompt()

# æ„å»ºåŠ¨æ€æç¤ºè¯
if custom_prompt and custom_prompt.strip():
    # ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯ï¼Œæ”¯æŒå ä½ç¬¦æ›¿æ¢
    prompt = custom_prompt.replace("{target_language}", target_language)
    prompt = prompt.replace("{translation_style}", translation_style)
else:
    # ä½¿ç”¨é»˜è®¤æ¨¡æ¿ï¼Œä½†æ ¹æ®è®¾ç½®åŠ¨æ€è°ƒæ•´
    prompt = f"""è¯·åˆ†æè¿™å¼ å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹...
    3. å°†æ‰€æœ‰æ–‡æœ¬ç¿»è¯‘æˆ{target_language}
    4. ç¿»è¯‘é£æ ¼ï¼š{translation_style}
    ..."""
```

## âœ… ä¿®å¤æ•ˆæœ

### ä¿å­˜åŠŸèƒ½
- âœ… ç›®æ ‡è¯­è¨€è®¾ç½®å¯ä»¥ä¿å­˜
- âœ… ç¿»è¯‘é£æ ¼è®¾ç½®å¯ä»¥ä¿å­˜  
- âœ… è‡ªå®šä¹‰æç¤ºè¯å¯ä»¥ä¿å­˜

### åŠ è½½åŠŸèƒ½
- âœ… é‡æ–°æ‰“å¼€è®¾ç½®çª—å£æ—¶æ˜¾ç¤ºå·²ä¿å­˜çš„è®¾ç½®
- âœ… åº”ç”¨é‡å¯åè®¾ç½®ä¾ç„¶æœ‰æ•ˆ

### åº”ç”¨åŠŸèƒ½
- âœ… ç¿»è¯‘æ—¶ä½¿ç”¨ä¿å­˜çš„ç›®æ ‡è¯­è¨€
- âœ… ç¿»è¯‘æ—¶ä½¿ç”¨ä¿å­˜çš„ç¿»è¯‘é£æ ¼
- âœ… ç¿»è¯‘æ—¶ä½¿ç”¨ä¿å­˜çš„è‡ªå®šä¹‰æç¤ºè¯

## ğŸ§ª æµ‹è¯•éªŒè¯

åˆ›å»ºäº† `test_settings_save.py` æµ‹è¯•è„šæœ¬ï¼š

```bash
python test_settings_save.py
```

æµ‹è¯•å†…å®¹ï¼š
1. **é…ç½®ä¿å­˜/åŠ è½½æµ‹è¯•** - éªŒè¯æ•°æ®èƒ½æ­£ç¡®ä¿å­˜åˆ°æ–‡ä»¶å¹¶è¯»å–
2. **é…ç½®æ–‡ä»¶æ£€æŸ¥** - éªŒè¯JSONæ–‡ä»¶ç»“æ„æ­£ç¡®
3. **GUIè®¾ç½®çª—å£æµ‹è¯•** - æ‰‹åŠ¨éªŒè¯ç•Œé¢ä¿å­˜åŠŸèƒ½

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

ä¿®å¤åçš„ `user_config.json` å°†åŒ…å«ï¼š

```json
{
  "api_provider": "openrouter",
  "openrouter": { ... },
  "advanced_settings": {
    "target_language": "ä¸­æ–‡",
    "translation_style": "è‡ªç„¶", 
    "custom_prompt": "ç”¨æˆ·è‡ªå®šä¹‰çš„æç¤ºè¯å†…å®¹..."
  }
}
```

## ğŸ¯ ä½¿ç”¨è¯´æ˜

### è®¾ç½®è‡ªå®šä¹‰æç¤ºè¯
1. æ‰“å¼€åº”ç”¨ï¼Œç‚¹å‡»"è®¾ç½®"æŒ‰é’®
2. åˆ‡æ¢åˆ°"é«˜çº§è®¾ç½®"æ ‡ç­¾é¡µ
3. åœ¨"è‡ªå®šä¹‰æç¤ºè¯"æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä½ çš„æç¤ºè¯
4. å¯ä»¥ä½¿ç”¨å ä½ç¬¦ï¼š
   - `{target_language}` - ä¼šè¢«æ›¿æ¢ä¸ºé€‰æ‹©çš„ç›®æ ‡è¯­è¨€
   - `{translation_style}` - ä¼šè¢«æ›¿æ¢ä¸ºé€‰æ‹©çš„ç¿»è¯‘é£æ ¼
5. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®

### éªŒè¯è®¾ç½®ç”Ÿæ•ˆ
1. ä¿å­˜è®¾ç½®åé‡æ–°æ‰“å¼€è®¾ç½®çª—å£ï¼Œæ£€æŸ¥è®¾ç½®æ˜¯å¦ä¿ç•™
2. è¿›è¡Œç¿»è¯‘æ—¶ï¼ŒAIä¼šä½¿ç”¨ä½ çš„è‡ªå®šä¹‰è®¾ç½®
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œä¼šæ˜¾ç¤ºä½¿ç”¨çš„ç¿»è¯‘è®¾ç½®

## ğŸ”® åç»­æ”¹è¿›å»ºè®®

1. **æç¤ºè¯æ¨¡æ¿** - æä¾›å¤šä¸ªé¢„è®¾æç¤ºè¯æ¨¡æ¿ä¾›é€‰æ‹©
2. **è®¾ç½®å¯¼å…¥/å¯¼å‡º** - æ”¯æŒè®¾ç½®çš„å¤‡ä»½å’Œæ¢å¤
3. **å®æ—¶é¢„è§ˆ** - åœ¨è®¾ç½®ç•Œé¢æ˜¾ç¤ºæœ€ç»ˆç”Ÿæˆçš„æç¤ºè¯é¢„è§ˆ
4. **è®¾ç½®éªŒè¯** - å¯¹è‡ªå®šä¹‰æç¤ºè¯è¿›è¡Œæ ¼å¼éªŒè¯

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨é«˜çº§è®¾ç½®å¯ä»¥æ­£å¸¸ä¿å­˜å’Œä½¿ç”¨äº†ã€‚** ğŸ‰
